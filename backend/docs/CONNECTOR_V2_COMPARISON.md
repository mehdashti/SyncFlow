# SyncFlow vs APISmith - Architecture Comparison

## Date: 2025-12-08

This document provides a point-by-point comparison of SyncFlow and APISmith so both teams share the same standards and operational expectations.

---

## 1. Technology Stack (Identical)
| Component | APISmith | SyncFlow | Notes |
|-----------|----------|----------|-------|
| Python Version | 3.13+ | 3.13+ | âœ… Same |
| Web Framework | FastAPI 0.115+ | FastAPI 0.115+ | âœ… Same |
| ASGI Server | Uvicorn[standard] | Uvicorn[standard] | âœ… Same |
| Package Manager | UV | UV | âœ… Same |
| Database | PostgreSQL | PostgreSQL | âœ… Same |
| ORM/Core | SQLAlchemy Core | SQLAlchemy Core | âœ… Same |
| DB Driver | asyncpg | asyncpg | âœ… Same |
| Migrations | Alembic | Alembic | âœ… Same |
| HTTP Client | httpx | httpx | âœ… Same |
| Logging | Loguru | Loguru | âœ… Same |
| Config | Pydantic Settings | Pydantic Settings | âœ… Same |
| UUID | uuid-utils (v7) | uuid-utils (v7) | âœ… Same |
| Hashing | xxhash, blake3 | xxhash, blake3 | âœ… Same |

**Conclusion**: Both services share the same tooling stack to minimize cognitive load and onboarding differences.

---

## 2. Project Structure (Identical)
- Shared monorepo layout with `backend/app`, `backend/docs`, etc.
- Features split into routers, services, repositories, and schemas in both services.
- Localized docs per service but identical folder hierarchy.

**Result**: Folder / file structure is identical to avoid confusion when traversing either repo.

---

## 3. Database Architecture (Identical)
- SQLAlchemy Core for database access (no ORM).
- Metadata-driven tables and async engines.
- Shared patterns for metadata, schemas, migrations.

**Result**: Consistent data modeling rules ensure compatibility between services.

---

## 4. Session Management (Identical)
- Both create async engine sessions with commit/rollback helpers.
- Dependency-injection via FastAPI context managers.

**Result**: Session lifecycles are the same, so developers can switch context without relearning.

---

## 5. Configuration Management (Identical)
- Pydantic Settings classes with `.env` support.
- Shared fields for database, API host/port, tokens, logging.

**Result**: Environment configuration works uniformly in both services.

---

## 6. Logging Setup (Identical)
- Loguru with file rotation.
- Structured context for service, batch IDs, etc.

**Result**: Logs can be correlated across services without translation.

---

## 7. Repository Pattern (Identical)
- Core API with `select`, `insert`, `update`, `delete` using SQLAlchemy Core tables.
- Reusable filters and builders.

**Result**: Both services follow the same repository conventions.

---

## 8. Core Dependencies (Matching)
- Same base dependencies such as FastAPI, Pydantic, SQLAlchemy, UUID utils.
- Differences only appear when additional service-specific libs are needed (e.g., APISmith uses SQL parsing libs, SyncFlow uses scheduling & normalization libs).

**Result**: Core dependency alignment is maintained while allowing service-specific additions.

---

## 9. UUID v7 Strategy (Identical)
- Both generate UUID v7 in Python before inserting into PostgreSQL.
- No server-default functions, no DB extensions.

**Result**: UUID handling is fully aligned.

---

## 10. Async/Await Pattern (Identical)
- End-to-end `async def` functions with `await` calls.
- Background tasks (SyncFlow) and executors (APISmith) keep asynchronous behavior consistent.

**Result**: Both services embrace async-first principles.

---

## 11. Error Handling Pattern (Identical)
- Try/except w/ rollbacks for DB operations.
- FastAPI HTTPException responses with `detail` payloads.

**Result**: Error surfaces and retries work the same across services.

---

## 12. Health Check Endpoints (Identical)
- `/api/v1/health` returning `status`, `service`, `version`, `environment`.
- Additional metadata endpoints share layout.

**Result**: Monitoring teams can rely on the same contract.

---

## 13. Alembic Configuration (Identical)
- Async migrations generated by Alembic scripts.
- Environment-specific env.py referencing the same metadata and PG connection strings.

**Result**: Migration practices are synchronized.

---

## 14. HTTP Client Pattern (Identical)
- Async httpx clients with connection pooling.
- Clients wrap service URLs, tokens, and retries.

**Result**: Downstream calls (SyncFlow â†’ APISmith, ScheduleHub) follow the same style.

---

## Summary Table
| Comparison | Conclusion | Notes |
|------------|------------|-------|
| Technology Stack | âœ… Same | Python 3.13, FastAPI, PostgreSQL, SQLAlchemy Core |
| Project Structure | âœ… Same | Identical folder structure and naming conventions |
| Database Architecture | âœ… Same | SQLAlchemy Core with metadata-only setup |
| Session Management | âœ… Same | Async sessions with commit/rollback helper functions |
| Configuration | âœ… Same | Pydantic Settings reading `.env` files |
| Logging | âœ… Same | Loguru with rotation and structured metadata |
| Repository Pattern | âœ… Same | Core API selectors/inserts/updates/deletes |
| Dependencies | ðŸ”„ Similar | Core deps aligned; service-specific extras differ |
| UUID Strategy | âœ… Same | Python-generated UUID v7 before insert |
| Async/Await | âœ… Same | Fully async implementation |
| Error Handling | âœ… Same | FastAPI HTTPExceptions and rollback semantics |
| Health Endpoints | âœ… Same | Shared response format for health & metadata |
| Alembic Setup | âœ… Same | Async migrations with metadata-driven env.py |
| HTTP Clients | âœ… Same | httpx + connection pooling for downstream calls |

---

## Final Conclusion
SyncFlow reuses the exact same architectural tools and patterns as APISmith. The only intentional differences are:
1. Database tables differ because SyncFlow needs ingestion, normalization, and delta tables that reflect its functionality.
2. SyncFlow includes additional services such as normalization, identity, and delta engines, while APISmith focuses on SQL execution.
3. SyncFlow relies on scheduling-related utilities (`apscheduler`, `python-dateutil`) whereas APISmith leans on ERP-specific drivers (`oracledb`, `pyodbc`).

## Harmonization Checklist
- âœ… Shared project structure confirmed
- âœ… Core repository pattern implemented in both services
- âœ… Core dependencies aligned; service-specific extras documented
- âœ… SyncFlow complies fully with APISmithâ€™s standards âœ…
